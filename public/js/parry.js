// Generated by CoffeeScript 1.6.3
var App;

App = Ember.Application.create({
  LOG_TRANSITION: true
});

App.ApplicationAdapter = DS.RESTAdapter.extend({
  namespace: 'api'
});

App.Router.map(function() {
  return this.resource('todos', {
    path: '/'
  }, function() {
    this.route('active');
    return this.route('completed');
  });
});

/*
App.Router.reopen
  location : 'history'
*/


App.Todo = DS.Model.extend({
  title: DS.attr('string'),
  isCompleted: DS.attr('boolean')
});

App.TodosRoute = Ember.Route.extend({
  model: function() {
    return this.store.find('todo');
  }
});

App.TodosIndexRoute = Ember.Route.extend({
  model: function() {
    return this.modelFor('todos');
  }
});

App.TodosController = Ember.ArrayController.extend({
  sortProperties: ['title'],
  actions: {
    createTodo: function() {
      var model, title;
      title = this.get('newTitle');
      title = title.trim();
      model = this.store.createRecord('todo', {
        title: title,
        isCompleted: false
      });
      model.save();
      return this.set('newTitle', '');
    },
    clearCompleted: function() {
      var model;
      model = this.filterBy('isCompleted', true);
      model.invoke('deleteRecord');
      return model.invoke('save');
    }
  },
  completed: (function() {
    return this.filterBy('isCompleted', true).get('length');
  }).property('@each.isCompleted'),
  remaining: (function() {
    return this.filterBy('isCompleted', false).get('length');
  }).property('@each.isCompleted'),
  inflection: (function() {
    var remaining;
    remaining = this.get('remaining');
    if (remaining > 1) {
      return "todos";
    } else {
      return "todo";
    }
  }).property('remaining')
});

App.TodoController = Ember.ObjectController.extend({
  isEditing: false,
  isCompleted: (function(key, value) {
    var model;
    model = this.get('model');
    if (value === void 0) {
      return model.get('isCompleted');
    } else {
      model.set('isCompleted', value);
      model.save();
      return value;
    }
  }).property('@each.isCompleted'),
  actions: {
    deleteTodo: function() {
      var model;
      model = this.get('model');
      model.deleteRecord();
      return model.save();
    },
    editTodo: function() {
      return this.set('isEditing', true);
    },
    acceptChanges: function() {
      var model, title;
      this.set('isEditing', false);
      model = this.get('model');
      title = this.get('title');
      model.set('title', title);
      return model.save();
    }
  }
});

App.TodosActiveRoute = Ember.Route.extend({
  model: function() {
    return this.store.filter('todo', function(todo) {
      return !todo.get('isCompleted');
    });
  },
  renderTemplate: function(controller) {
    return this.render('todos/index', {
      controller: controller
    });
  }
});

App.TodosCompletedRoute = Ember.Route.extend({
  model: function() {
    return this.store.filter('todo', function(todo) {
      return todo.get('isCompleted');
    });
  },
  renderTemplate: function(controller) {
    return this.render('todos/index', {
      controller: controller
    });
  }
});

App.EditTodoView = Ember.TextField.extend({
  didInsertElement: function() {
    return this.$().focus();
  }
});

Ember.Handlebars.helper('edit-todo', App.EditTodoView);
